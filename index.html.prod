<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>La Fortaleza v2.4 - Aventura de Texto</title><link rel="icon" type="image/png" href="favicon.png"><style>@font-face{font-family:'IBM VGA';src:url('Flexi_IBM_VGA_True.ttf') format('truetype');font-weight:400;font-style:normal}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'IBM VGA',Courier,monospace;background-color:#000;color:#45bf45;padding:20px;line-height:1.4;font-size:160%}#game-container{max-width:900px;margin:0 auto;background-color:#000;xborder:2px solid #0f0;padding:20px;position:relative;overflow:hidden}#title{text-align:center;font-size:34px;margin-bottom:20px;color:#0f0;border-bottom:2px solid #0f0;padding-bottom:10px}#output{min-height:400px;max-height:500px;overflow-y:auto;margin-bottom:20px;padding:10px;xborder:1px solid #0f0}#output::-webkit-scrollbar{width:10px}#output::-webkit-scrollbar-track{background:#000}#output::-webkit-scrollbar-thumb{background:#123312}.output-line{margin-bottom:8px;position:relative;overflow:hidden}.text-scanline{position:absolute;left:0;top:50%;transform:translateY(-50%);width:2px;height:100%;background:rgba(57,255,20,.9);box-shadow:0 0 6px #39ff14,0 0 12px rgba(57,255,20,.7),0 0 18px rgba(57,255,20,.3);z-index:5}.text-scanline-dot{position:absolute;right:-3px;top:50%;transform:translateY(-50%);width:4px;height:4px;background:#fff;border-radius:50%;box-shadow:0 0 8px #39ff14,0 0 16px rgba(57,255,20,.6),0 0 24px rgba(57,255,20,.3)}.text-reveal{position:relative;display:inline-block}.text-mask{position:absolute;top:0;left:0;right:0;bottom:0;background:#000;z-index:4}#input-container{display:flex;gap:10px}#input{flex:1;background-color:#000;color:#0f0;border:1px solid #0f0;padding:10px;font-family:'IBM VGA',Courier,monospace;font-size:14px}#input:focus{outline:0;border-color:#0f0;xbox-shadow:0 0 5px #0f0}button{background-color:#000;color:#0f0;border:1px solid #0f0;padding:10px 20px;cursor:pointer;font-family:'IBM VGA',Courier,monospace;font-size:14px}button:hover{background-color:#0f0;color:#000}#fullscreen-btn{padding:10px 15px;margin-left:10px;font-size:18px;line-height:1}#inventory{margin-top:20px;padding:10px;border:1px solid #0f0}#inventory h3{margin-bottom:10px}.prompt{color:#ff0}.error{color:#ff9500}.success{margin-top:30px;color:#fc0}.system{color:#09ff00}:root{--phosphor:#39ff14;--scanline-strength:.08;--vignette-strength:.60}body{background:radial-gradient(ellipse at center,#020402 0,#000 90%);letter-spacing:.3px;position:relative}body::before{content:"";position:fixed;inset:0;pointer-events:none;z-index:9999;background:repeating-linear-gradient(0deg,rgba(0,0,0,.5) 0,rgba(0,0,0,.5) 2px,transparent 2px,transparent 4px);opacity:var(--scanline-strength)}#game-container{position:relative;overflow:hidden;border-radius:16px;background:#000;box-shadow:inset 0 0 60px rgba(57,255,20,.06),inset 0 0 140px rgba(0,0,0,.9),0 0 0 1px rgba(57,255,20,.08);isolation:isolate;backface-visibility:hidden}.crt-screen{position:relative;z-index:0;backface-visibility:hidden;filter:url(#crt-warp)}#game-container::before{content:"";position:absolute;inset:0;pointer-events:none;mix-blend-mode:overlay;border-radius:inherit;background:repeating-linear-gradient(0deg,rgba(0,0,0,.5) 0,rgba(0,0,0,.5) 2px,transparent 2px,transparent 4px);opacity:var(--scanline-strength);z-index:1}#game-container::after{content:"";position:absolute;inset:0;border-radius:inherit;pointer-events:none;background:radial-gradient(ellipse at center,rgba(0,0,0,0) 40%,rgba(0,0,0,var(--vignette-strength)) 100%),radial-gradient(ellipse at center,rgba(57,255,20,.12),rgba(0,0,0,0) 55%);mix-blend-mode:multiply;z-index:4}.crt-scanline{position:absolute;left:0;right:0;height:4px;top:-6px;background:linear-gradient(to bottom,rgba(255,255,255,.45),rgba(255,255,255,0));mix-blend-mode:screen;opacity:.25;pointer-events:none;z-index:2;will-change:top;animation:crtScanTop 30s linear infinite}@keyframes crtScanTop{0%{top:-6px}100%{top:calc(100% + 6px)}}.crt-flicker{position:absolute;inset:0;border-radius:inherit;pointer-events:none;mix-blend-mode:screen;z-index:3;background:rgba(57,255,20,.06);animation:crtFlicker 1.9s steps(1000) infinite}@keyframes crtFlicker{0%{opacity:.98}50%{opacity:1}100%{opacity:.99}}.crt-scanline{height:18px;opacity:.02;animation-duration:11s}.crt-flicker{background:rgba(57,255,20,.12)}#title{letter-spacing:3px;text-shadow:0 0 .6px var(--phosphor),0 0 6px rgba(57,255,20,.45),0 0 18px rgba(57,255,20,.15);border-bottom:1px dashed rgba(57,255,20,.25)}#output{text-shadow:0 0 1px rgba(57,255,20,.8),0 0 6px rgba(57,255,20,.46),0 0 24px rgba(57,255,20,.35),1px 0 0 rgba(255,0,0,.135),-1px 0 0 rgba(0,255,255,.135)}#input-container{position:relative;border-top:1px dashed rgba(57,255,20,.25);padding-top:10px;display:flex;align-items:center}#input-container::before{content:">";position:absolute;left:4px;color:var(--phosphor);text-shadow:0 0 .6px var(--phosphor),0 0 6px rgba(57,255,20,.45);opacity:.9;animation:blink 1.2s steps(1) infinite;line-height:1}@keyframes blink{0%,50%{opacity:1}100%,51%{opacity:.4}}.autocomplete-suggestion{position:absolute;pointer-events:none;color:#26ff00;font-family:'IBM VGA',Courier,monospace;z-index:1;white-space:pre}#input{background:0 0;border:none;border-bottom:1px solid rgba(57,255,20,.35);padding:10px 8px 6px 22px;font:inherit;color:var(--phosphor);caret-color:var(--phosphor);box-shadow:none;text-shadow:0 0 1px var(--phosphor),0 0 10px rgba(57,255,20,.28),0 0 24px rgba(57,255,20,.12)}#input::placeholder{color:rgba(57,255,20,.35)}button{background:rgba(0,0,0,.5);color:var(--phosphor);border:1px solid rgba(57,255,20,.35);border-radius:6px;text-shadow:0 0 1px var(--phosphor),0 0 10px rgba(57,255,20,.28);box-shadow:0 0 0 1px rgba(57,255,20,.12) inset,0 0 24px rgba(57,255,20,.08) inset;transition:transform .06s ease,box-shadow .12s ease,background .12s ease}button:hover{background:rgba(57,255,20,.12);box-shadow:0 0 40px rgba(57,255,20,.18) inset}button:active{transform:translateY(1px)}.prompt{text-shadow:0 0 1px #dfff8f,0 0 12px rgba(223,255,143,.5)}.error{text-shadow:0 0 1px #ff9500,0 0 12px rgba(255,149,0,.5)}.success{text-shadow:0 0 1px #c9ffcf,0 0 12px rgba(201,255,207,.5)}.system{text-shadow:0 0 1px #09ff00,0 0 10px rgba(9,255,0,.5)}body,html{height:100%;margin:0}body{padding:0}#game-container{position:fixed;inset:0;max-width:none;padding:24px;display:block;border-radius:16px}.crt-screen{position:relative;height:100%;display:grid;grid-template-columns:2fr 1fr;grid-template-rows:auto 1fr auto;gap:16px;z-index:0;backface-visibility:hidden}#right-sidebar{grid-column:2;grid-row:1/span 3;display:flex;flex-direction:column;justify-content:center;align-items:center;overflow:hidden}#room-image{width:100%;height:auto;border-radius:12px;border:1px solid rgba(57,255,20,.25);display:block;flex-shrink:0;position:relative}#room-image-container{position:relative;overflow:visible;width:100%}.image-transition-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background:#000;pointer-events:none;z-index:10}.scanline-wipe{position:absolute;left:0;right:0;height:2px;background:rgba(57,255,20,.8);box-shadow:0 0 8px #39ff14,0 0 16px rgba(57,255,20,.8),0 0 24px rgba(57,255,20,.4);z-index:11}.scanline-dot{position:absolute;right:0;top:50%;transform:translateY(-50%);width:6px;height:6px;background:#fff;border-radius:50%;box-shadow:0 0 12px #39ff14,0 0 24px rgba(57,255,20,.8),0 0 36px rgba(57,255,20,.4);z-index:12}#location-name{text-align:center;margin:0 auto;padding:8px 16px;border:1px solid rgba(57,255,20,.25);border-radius:8px;background:rgba(0,0,0,.9);letter-spacing:2px;text-shadow:0 0 1px var(--phosphor),0 0 6px rgba(57,255,20,.45),0 0 18px rgba(57,255,20,.15);position:relative;transform:translateY(-50%);width:fit-content;max-width:90%}#title{grid-column:1;grid-row:1}#output{grid-column:1;grid-row:2;overflow-y:auto;max-height:none!important;min-height:0!important}#input-container{grid-column:1;grid-row:3}#inventory{margin:0;padding:12px 12px 12px 16px;border:1px solid rgba(57,255,20,.25);border-radius:12px;background:rgba(0,0,0,.35);overflow:auto;flex:1;min-height:0}#inventory h3{position:sticky;top:0;background:#000;padding-bottom:8px;margin:0 0 12px;z-index:1;border-bottom:1px dashed rgba(57,255,20,.35)}#input{width:100%}@media (max-width:900px){.crt-screen{grid-template-columns:1fr;grid-template-rows:auto 1fr auto auto}#inventory{grid-column:1;grid-row:4}}.crt-noise{position:absolute;inset:0;pointer-events:none;z-index:2;opacity:.025;mix-blend-mode:screen;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" stitchTiles="stitch"/></filter><rect width="200" height="200" filter="url(%23n)" opacity="1"/></svg>');background-size:200px 200px}</style></head><body><svg width="0" height="0" style="position:absolute;left:-9999px;top:-9999px"><filter id="crt-warp" x="-10%" y="-10%" width="120%" height="120%"><feTurbulence type="fractalNoise" baseFrequency="0.00015 0.003" numOctaves="1" seed="2" result="noise"/><feGaussianBlur in="noise" stdDeviation="2" result="softNoise"/><feDisplacementMap in="SourceGraphic" in2="softNoise" scale="34" xChannelSelector="R" yChannelSelector="G"/></filter></svg><div id="game-container"><div class="crt-scanline" aria-hidden="true"></div><div class="crt-flicker" aria-hidden="true"></div><div class="crt-noise" aria-hidden="true"></div><div class="crt-screen"><div id="title">LA FORTALEZA <span style="font-size:12px;opacity:.5">v2.4</span></div><div id="output"></div><div id="input-container"><input type="text" id="input" placeholder="Escribe tu comando aquí..." autocomplete="off" autofocus> <button onclick="processCommand()">ENVIAR</button> <button id="fullscreen-btn" onclick="toggleFullscreen()" title="Toggle Fullscreen">⛶</button></div><div id="right-sidebar"><div id="room-image-container"><img id="room-image" src="images/room_entrance.jpg" alt="Room"></div><div id="location-name">EXTERIOR DE LA FORTALEZA</div></div></div></div><script>const e={"el exterior de la fortaleza":["images/room_entrance.jpg"],"el Salón de recepciones":["images/room_reception.jpg"],"la Sala de juegos":["images/room_game.jpg"],"el Patio interior":["images/room_patio.jpg","images/room_patio_2.jpg"],"el Jardín":["images/room_gardens.jpg","images/room_gardens_2.jpg"],"la Biblioteca":["images/room_library.jpg"],"el Cuarto de espejos":["images/room_mirrors.jpg"],Pasillo:["images/room_pasillo.jpg"],"la Alcoba de la bruja":["images/room_witch.jpg"],"el Cuarto del guerrero":["images/room_warrior.jpg"],"el Laboratorio de la Bestia":["images/room_lab.jpg"],"la Sala de armas":["images/room_armory.jpg"],"los Baños de la Bestia":["images/room_bathroom.jpg"],"la Alcoba de la doncella":["images/room_maid.jpg"],"la Sala de infusiones":["images/room_tearoom.jpg"],"los Calabozos":["images/room_jail.jpg"],"los Almacenes de la Fortaleza":["images/room_warehouse.jpg"],"Salón de cristal":["images/room_crystal.jpg"],"Boca de la Bestia":["images/room_mouth.jpg"],"Interior de la Bestia":["images/room_beast_interior.jpg"],"Pulmones de la Bestia":["images/room_lungs.jpg"],"el Estómago de la Bestia":["images/room_stomach.jpg"],"el Corazón de la Bestia":["images/room_heart.jpg"],"el Cerebro de la Bestia":["images/room_brain.jpg"],"un extenso páramo":["images/room_moor.jpg"]};function a(a){const t=e[a];return t&&t.length>0?t[Math.floor(Math.random()*t.length)]:"images/room_entrance.jpg"}function t(e){const t=document.getElementById("room-image"),s=document.getElementById("room-image-container");if(!t||!s)return;const r=a(e);if(t.src.endsWith(r))return;const n=document.createElement("div");n.className="image-transition-overlay";const o=document.createElement("div");o.className="scanline-wipe",o.style.top="0px";const i=document.createElement("div");i.className="scanline-dot",o.appendChild(i),s.appendChild(n),s.appendChild(o);const l=new Image;l.onload=()=>{const e=t.offsetHeight,a=performance.now();t.src=r,requestAnimationFrame(function t(r){const i=r-a,l=Math.min(i/800,1),d=(l<.5?2*l*l:1-Math.pow(-2*l+2,2)/2)*e;o.style.top=d+"px",n.style.clipPath=`inset(${d}px 0 0 0)`,l<1?requestAnimationFrame(t):(s.removeChild(n),s.removeChild(o))})},l.src=r}function s(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function r(){const e={currentRoomIndex:U.rooms.indexOf(U.player.curr),inventoryItems:U.player.bag.items.map(e=>e.name),roomStates:U.rooms.map(e=>({items:e.items.map(e=>({name:e.name,dead:e.dead||!1,open:void 0!==e.open?e.open:void 0})),visited:e.visited})),playerVisits:U.player.visits,gameOver:U.gameOver,gameWon:U.gameWon,timestamp:(new Date).toISOString()};return JSON.stringify(e)}function n(e){try{const a=JSON.parse(e);U.player.curr=U.rooms[a.currentRoomIndex],U.player.bag.items=[];for(let e of a.inventoryItems)for(let a of U.rooms)if(a.items.find(a=>a.name===e)){const t=a.take(e);if(t){U.player.bag.items.push(t);break}}return a.roomStates.forEach((e,a)=>{U.rooms[a].visited=e.visited;const t=e.items.map(e=>e.name);U.rooms[a].items=U.rooms[a].items.filter(e=>t.includes(e.name)),e.items.forEach(e=>{const t=U.rooms[a].items.find(a=>a.name===e.name);t&&(void 0!==e.dead&&(t.dead=e.dead),void 0!==e.open&&(t.open=e.open))})}),U.player.visits=a.playerVisits,U.gameOver=a.gameOver,U.gameWon=a.gameWon,!0}catch(e){return z("Error al cargar la partida: "+e.message,"error"),!1}}function o(){const e=[];for(let a=0;a<localStorage.length;a++){const t=localStorage.key(a);if(t.startsWith("fortaleza_save_")){const a=t.replace("fortaleza_save_",""),s=localStorage.getItem(t);try{const t=JSON.parse(s);e.push({name:a,timestamp:t.timestamp})}catch(e){}}}return e}function i(e){if(!e||""===e.trim())return void z("Debe proporcionar un nombre para el juego.","error");const a="fortaleza_save_"+e.trim(),t=r();try{localStorage.setItem(a,t),z("Juego guardado como: "+e,"success")}catch(e){z("Error al guardar: "+e.message,"error")}}function l(e){if(!e||""===e.trim())return void z("Debe proporcionar un nombre de juego.","error");const a="fortaleza_save_"+e.trim(),t=localStorage.getItem(a);t?n(t)&&(z("Juego cargado: "+e,"success"),B(),U.player.look()):z("No existe un juego con ese nombre.","error")}function d(e){if(!e||""===e.trim())return void z("Debe proporcionar un nombre de juego.","error");const a="fortaleza_save_"+e.trim();localStorage.getItem(a)?(localStorage.removeItem(a),z("Juego eliminado: "+e,"success")):z("No existe un juego con ese nombre.","error")}function u(){const e=o();0!==e.length?(z("Juegos guardados:","system"),e.forEach(e=>{const a=new Date(e.timestamp).toLocaleString("es-ES");z("  - "+e.name+" ("+a+")")})):z("No hay juegos guardados.","system")}class c{constructor(e,a,t){this.name=e,this.desc=a,this.mass=t,this.items=[]}image(){return this.desc}get(e){const a=s(e.toLowerCase().trim());let t=this.items.find(e=>s(e.name.toLowerCase())===a);if(t)return t;let r=this.items.filter(e=>s(e.name.toLowerCase()).startsWith(a));return r.length>0?r.reduce((e,a)=>a.name.length<e.name.length?a:e):this.items.find(e=>s(e.name.toLowerCase()).includes(a))}take(e){const a=this.get(e);return a&&(this.items=this.items.filter(e=>e!==a)),a}insert(e){this.items.push(e)}}class m extends c{constructor(e,a,t){super(e,a,t),this.dead=!1}speak(){z("...")}die(e){return this.dead=!0,!0}accept(e){}}class p extends m{constructor(e,a,t,s,r){super(e,a,100),this.likeness=t,this.hiData=s,this.lowData=r,this.happy=!1}speak(){this.happy?z(this.hiData):z(this.lowData)}accept(e){this.happy=e.name.toLowerCase()===this.likeness.toLowerCase(),this.happy?z("¡Muchas muchas gracias!"):z("Gracias.")}die(e){return z("¡Ahhhhhhh!"),super.die(e)}}class g extends m{constructor(e,a,t,s){super(e,a,999),this.confession=t,this.lethalWeapon=s}die(e){return(e?e.toLowerCase():"")===(this.lethalWeapon?this.lethalWeapon.toLowerCase():"")?(z(this.confession),super.die(e)):(z("¡Ja ja ja! ¡Eso no me hará daño!"),!1)}}class h extends c{constructor(e,a,t,s,r){super(e,a,999),this.destination=r,this.passComment=s,this.key=t||"",this.open=""===t||null===t}openDoor(e){return!(""!==this.key&&!e.toLowerCase().includes(this.key.toLowerCase())||(this.open=!0,0))}pass(e){this.passComment&&z(this.passComment)}dest(){return this.open?this.destination:null}}class b extends h{constructor(e,a,t,s){super(e,a,"",t,s),this.open=!0}}class f extends h{constructor(e,a,t,s,r,n){super(e,a,t,s,n),this.talisman=r}pass(e){const a=U.player;a.bag.get(this.talisman)?super.pass(e):(z("No tiene protección. Usted muere."),a.die(""),U.gameOver=!0)}}class v extends f{pass(e){const a=U.player;a.bag.get(this.talisman)?(z("El objeto "+this.talisman+" lo mata."),a.die(""),U.gameOver=!0):h.prototype.pass.call(this,e)}}class w extends h{constructor(e,a,t,s,r,n){super(e,a,"",r,n),this.riddle=t,this.answer=s,this.open=!1}openDoor(e){return e.toLowerCase()===this.answer.toLowerCase()?(z("¡Ha resuelto el acertijo!"),this.open=!0,!0):(""===e?(z("Debe resolver el acertijo primero:"),z(this.riddle)):(z("Respuesta incorrecta. El acertijo es:"),z(this.riddle)),!1)}}class y extends c{constructor(e,a,t,s){super(e,a,999),this.breaker=t,this.hiddenThing=s}breakWith(e){return!(this.breaker&&!e.toLowerCase().includes(this.breaker.toLowerCase()))}}class E extends c{constructor(e,a){super(e,a,999),this.visited=!1}describe(){this.items.length>0&&z("Ves aquí: "+this.items.map(e=>e.name).join(", "))}openItem(e,a){const t=this.get(e);if(t&&(t instanceof h||t instanceof w))if(t.open)z("Ya está abierto.");else if(t.openDoor(a)){if(t.destination&&t.destination instanceof E){const s=t.destination.get(e);s&&(s instanceof h||s instanceof f||s instanceof v||s instanceof w||s instanceof b)&&s.openDoor(a)}z("Ok.")}else z("No puede abrir esto."),z(""===a?"Necesita una palabra clave.":'"'+a+'" no es la palabra correcta.');else z(e?'No puede hacer eso. No hay "'+e+'" en esta habitación.':"Complete su frase.")}breakItem(e,a){const t=this.get(e);if(t&&t instanceof y)if(t.breakWith(a)){const e=t.hiddenThing;this.items=this.items.filter(e=>e!==t),this.items.push(e),z("¡Crash! Usted ha roto "+t.name+"."),z("¡Sorpresa! Ha encontrado: "+e.name)}else z("No puede romper eso con "+a);else z(e?"No se puede romper eso.":"Complete su frase.")}}class j extends E{constructor(){super("Mochila","Su mochila")}empty(){return 0===this.items.length}heaviness(){return this.items.reduce((e,a)=>e+a.mass,0)}describe(){if(this.empty())return;for(let e of this.items)z(e.name+" ("+e.mass+")");const e=U.maxWeight-this.heaviness();z(0===e?"No puede cargar nada más.":1===e?"Está a punto de agotar sus capacidades.":"Podría cargar "+e+" bolsas más.")}}class C extends m{constructor(e,a){super(e,a,0),this.curr=null,this.bag=new j,this.visits=0,this.firstLook=!0}go(e){this.dead||(this.curr=e,e.visited||(e.visited=!0,this.visits++))}look(e=!1){if(this.dead)return;e&&!this.firstLook&&(document.getElementById("output").innerHTML=""),this.firstLook&&(this.firstLook=!1),z(""),z("Estás en "+this.curr.name+".","success"),z(this.curr.desc),z(""),this.curr.describe();const a=document.getElementById("location-name");a&&(a.textContent=this.curr.name.toUpperCase()),t(this.curr.name)}inventary(){this.dead||(this.bag.empty()?z("Usted no lleva nada consigo."):(z("Sus pertenecias son:"),this.bag.describe()))}see(e){if(this.dead)return;if(!e)return void z("¿Qué quieres ver?");let a=this.curr.get(e);a?z(a.image()):(a=this.bag.get(e),z(a?a.image():'No existe "'+e+'" en este lugar. Entre sus pertenencias tampoco.'))}take(e){if(this.dead)return;const a=this.curr.get(e);a?a.mass>U.maxWeight?z("Usted no puede cargar con eso."):this.bag.heaviness()+a.mass<=U.maxWeight?(this.bag.insert(this.curr.take(e)),z("Ok."),B()):z("Sería demasiado peso."):z(e?'No existe "'+e+'" en este lugar.':"Complete su frase.")}leave(e){this.dead||(this.bag.get(e)?(this.curr.insert(this.bag.take(e)),z("Ok."),B()):z(e?'"'+e+'" no está dentro de sus pertenencias.':"Complete su frase."))}leaveAll(){if(!this.dead)if(this.bag.empty())z("Usted no lleva nada consigo.");else{for(;!this.bag.empty();){const e=this.bag.items[0];this.curr.insert(this.bag.take(e.name))}z("Usted deja todas sus pertencias en el suelo."),B()}}openD(e,a){this.dead||(a&&(z("Invocas las palabras mágicas:"),z(a+"!!!")),this.curr.openItem(e,a))}walkT(e){if(this.dead)return;const a=this.curr.get(e);if(a&&(a instanceof h||a instanceof b||a instanceof f||a instanceof v||a instanceof w)){const e=a.dest();if(e){const t=document.getElementById("output"),s=Array.from(t.children);let r=-1;for(let e=s.length-1;e>=0;e--)if(s[e].classList.contains("prompt")){r=e;break}if(r>=0){const e=s.slice(r);t.innerHTML="",e.forEach(e=>t.appendChild(e))}this.go(e),a.pass(this),this.dead||this.look()}else z("¡Auch! Te golpeas la cabeza."),z("Sería más fácil si primero abrieras la puerta.")}else z(e?"No puedes atravesar eso.":"Complete su frase.")}kill(e,a){if(this.dead)return;const t=this.curr.get(e);if(t&&(t instanceof p||t instanceof g)){if(a&&!this.bag.get(a))return void z('"'+a+'" no está dentro de sus pertenencias.');t.die(a)&&(this.curr.items=this.curr.items.filter(e=>e!==t))}else z(e?'"'+e+'" no está aquí.':"Complete su frase.")}ask(e){if(this.dead)return;const a=this.curr.get(e);a&&(a instanceof p||a instanceof g)?a.speak():z(e?'"'+e+'" no está aquí.':"Complete su frase.")}give(e,a){if(this.dead)return;if(this.bag.empty())return void z("Usted no lleva nada consigo.");const t=this.curr.get(a);if(t&&t instanceof p){const a=this.bag.take(e);a?(t.accept(a),B()):z('"'+e+'" no está dentro de sus pertenencias.')}else z(a?"Ese regalo no es aceptado.":"¿Para quién es el regalo?")}breakItem(e,a){this.dead||(!a||this.bag.get(a)?this.curr.breakItem(e,a):z('"'+a+'" no está dentro de sus pertenencias.'))}weigh(e){if(this.dead)return;if(!this.bag.get("Balanza"))return void z("Usted no trae la balanza.");let a=this.bag.get(e);if(a||(a=this.curr.get(e)),a)if("balanza"===a.name.toLowerCase())z("Usted trata infructuosamente de colocar la balanza sobre ella misma.");else if(a.mass>U.maxWeight)z("¡Se ha vuelto loco! ¿Cómo va a pesar eso?");else{const e=1===a.mass?"bolsa":"bolsas";z("Usted coloca el objeto en el plato de la balanza."),z("La aguja indica "+a.mass+" "+e+".")}else z(e?'No hay "'+e+'" en este lugar. Ni en sus pertenencias tampoco.':"Complete su frase.")}die(e){return this.dead||(super.die(e),z("¡Me estoy muriendo!","error")),!0}}const U={player:null,rooms:[],currentRoom:null,gameOver:!1,gameWon:!1,maxWeight:40},k=["","Hay un nombre que vas a necesitar mucho: Rumpelstinskin.","Abrete Sesamo","Ariete","Maza","Busca a la doncella al lado del espejo que romperás con un hueso. Ella te dirá dónde está el final de la Bestia.","Treinta y nueve","Lanza","Para llegar a los pulmones de la Bestia debes tener el talisman de aire.","Paraguas","En la biblioteca hay un libro que conduce al jardín.","Hueso de gato",' Puedes pasar, la contraseña es "Nombus Rostomelaris"',"Maza","Nombus Rostomelaris","Luz",'Usted cae durante varios minutos y, gracias al candelabro, cuando toca el suelo no se hace daño. Oye una voz que dice: "Sea gentil con la doncella, regálele una flor."','Escucha bien, hijo. Cuando te digan "Prohibido", invoca la luz. Recuerda que la palabra crea a su significado.',"Hacha","Pocion para crecer","Para atravezar por el escaparate de la bruja, debes llevar un candelabro. Y al hacerlo vas a conocer algo importante.","Polvo magico","El corazón de unicornio te protegerá en el corazón de la Bestia.","Rumpelstinskin","Rosa","La última habitación está al principio.","Imnus humiscuol rastomislakis!! Con esta esapada matarás a los pulmones de la Bestia.","Espada","Taza de cafe","Al entrar al estómago, lleva contigo un pastel.","Talisman de aire","Pastel de cerezas","Espada","Latigo","Daga","Usted ha destruido los pulmones! Solo con un látigo podrás destruir el estómago.","Usted ha destruido el estómago! Solo con una daga podrás destruir el corazón.","Usted ha destruido el corazón! Busca el cerebro de la bestia lejos de aquí. Solo el fuego puede destruirlo.","Antorcha","¿Mataste al Troll?","Piedra filosofal","Cuidado con el túnel y la puerta de tela. Solo conducen a la muerte.","Agua","nada",'AAARRRRGGGG!!!! La palabra mágica es "Agua".',"Arco","Maquina del tiempo"];function q(e){return k[e]||""}function L(){U.player=new C("Indy","Aventurero"),P(),U.player.go(U.rooms[0]),z("Bienvenido a LA FORTALEZA","success"),z("");const e=(new Date).getHours();z(e<12?"Buenos días.":e>18?"Buenas noches.":"Buenas tardes."),z(""),z('Escribe "ayuda" para ver los comandos disponibles.'),U.player.look()}function P(){const e=[];e[0]=new E("el exterior de la fortaleza","Las paredes son muy negras y al parecer, no tienen ventanas. Usted trata de ver el final de las torres, pero las nubes no se lo permiten."),e[1]=new E("el Salón de recepciones","Parece hecho para criaturas cientos de veces más grandes que los humanos. Está desierto, pero usted siente que es observado."),e[2]=new E("la Sala de juegos","Usted trata de imaginar cómo eran los juegos del salón. Hay doce mesas y cada una tiene doce erizos."),e[3]=new E("el Patio interior","El patio tiene forma de caracol. Cada uno o dos pasos se levanta una columna de mármol negro y se confunde en la altura con los árboles. Usted siente el crujido de las hojas secas bajo sus zapatos."),e[4]=new E("el Cuarto de espejos","Hay tantos espejos que no puede reconocer si usted es real o es una imagen de sí mismo."),e[5]=new E("la Biblioteca","Hay miles de libros en este lugar. Todos tienen alguna hoja marcada con una servilleta."),e[6]=new E("Pasillo","Tiene tres puertas al lado y una al final."),e[7]=new E("la Alcoba de la bruja","Hasta un ciego descubriría que aquí habita una bruja. El cuarto tiene una ventana, pero usted no recuerda haberla visto desde afuera."),e[8]=new E("el Cuarto del guerrero","El cuarto está muy ordenado. A usted le sorprende que no hayan armas."),e[9]=new E("el Laboratorio de la Bestia","Hay muchos frascos. A usted le llaman la atención los últimos: están llenos de homúnculos."),e[10]=new E("la Sala de armas","Este lugar parece salido del sueño de un guerrero."),e[11]=new E("los Baños de la Bestia","El baño es tan grande que usted no puede ver las paredes que lo limitan."),e[12]=new E("el Jardín","Se podrían construir varias ciudades en su interior."),e[13]=new E("la Alcoba de la doncella","Es una habitación muy pequeña y húmeda."),e[14]=new E("la Sala de infusiones","Hay varias mesas regadas por el suelo. Usted tiene la impresión de que ningún humano ha estado en ese lugar anteriormente."),e[15]=new E("los Calabozos","Son tan húmedos que usted no resistiría ni unas horas dentro de ellos."),e[16]=new E("Boca de la Bestia","Es como una boca humana, pero del tamaño de una casa."),e[17]=new E("Interior de la Bestia","Usted puede sentir los latidos del corazón de la Bestia, al igual que su respiración o el ruido de los líquidos revueltos en su estómago."),e[18]=new E("Pulmones de la Bestia","Sopla un aire tan fuerte que usted se ha tirado al suelo."),e[19]=new E("el Estómago de la Bestia","Hay varios esqueletos humanos."),e[20]=new E("el Corazón de la Bestia","Todo palpita rítmicamente. Usted siente cómo los latidos se adueñan del lugar, especialmente de su propio corazón."),e[21]=new E("el Cerebro de la Bestia","Es como un tarjetero gigante. Cada idea está escrita en una tarjeta y, cuando es necesario, la tarjeta es sacada por una mano invisible y leída al resto de la Bestia."),e[22]=new E("los Almacenes de la Fortaleza","Están llenos de carne humana. Usted aparta el cadáver de una mujer para poder observar bien el lugar."),e[23]=new E("un extenso páramo","Hay muy poca vegetación y el suelo es pantanoso. Usted nunca imaginó que el interior de la fortaleza fuera tan grande."),e[24]=new E("Salón de cristal","Es como un caleidoscopio gigante. Cada varios segundos las paredes cambian de color y usted siente como si lo hubieran trasladado a otro lugar."),U.rooms=e,x(e)}function x(e){e[0].insert(new c("Roble",'Está completamente seco y lleno de mordiscos. Tiene las siguientes palabras talladas en el tronco: "Las palabras mágicas para abrir la puerta son obvias."',200)),e[0].insert(new c("Maza","Es muy pesada.",39)),e[0].insert(new c("Pastel de cerezas","¿Qué hace un pastel de cerezas en un lugar como este?",2)),e[0].insert(new p("Llamador de bronce","Parece de carne, y tiene forma de murciélago.","Cigarro",q(1),"¿Me puede regalar un cigarro?")),e[0].insert(new h("Puerta principal","Inmensa y oprimente.",q(2),"Su sombra desaparece lentamente al cruzar la puerta. Siente cómo el miedo se le enreda en los zapatos.",e[1])),e[0].insert(new b("Túnel","Parece muy largo.","El olor de la carne descompuesta lo golpea. Usted siente ganas de vomitar.",e[3])),e[1].insert(new c("Retrato","Es de Hitchcock (un anacronismo). Usted recuerda instintivamente algunas películas que le erizaron la piel: Psicosis, Vértigo y Los treinta y nueve escalones.",1)),e[1].insert(new h("Puerta principal","Inmensa y oprimente.",q(2),"Usted se siente de regreso a la vida. Ha salido de La Fortaleza.",e[0])),e[1].insert(new h("Puerta negra","Es muy negra.","","Usted atraviesa la puerta sin dificultades.",e[2])),e[2].insert(new c("Escoba","Es una escoba voladora.",1)),e[2].insert(new c("Hilo de Ariadna","Debe tener varios kilómetros de largo.",1)),e[2].insert(new c("Inscripción",'Dice: "Cuando hayas llegado casi al final, tendrás que regresar, a no ser que hayas hablado con el murciélago."',10)),e[2].insert(new h("Puerta negra","Es muy negra.","","Usted atraviesa la puerta sin dificultades.",e[1])),e[2].insert(new h("Puerta azul","Esta puerta conduce al patio interior.","","Usted atraviesa la puerta sin dificultades.",e[3])),e[2].insert(new w("Escalera","La escalera está detrás de una puerta de cristal. Usted trata de ver cuántos escalones tiene, pero no puede.","¿Cuántos peldaños tiene la escalera?",q(6),"Usted sube por la escalera. No se explica cómo, siendo tan larga, solo tiene "+q(6)+" escalones.",e[4])),e[3].insert(new c("Balanza","La balanza tiene el plato en forma de mano. La aguja es muy delgada, hecha con varios bigotes de gato trenzados entre sí.",1)),e[3].insert(new h("Puerta azul","Esta puerta conduce a la sala de juegos.","","Usted atraviesa la puerta sin dificultades.",e[2])),e[3].insert(new h("Puerta verde","Esta puerta conduce a la biblioteca.","","Usted atraviesa la puerta sin dificultades.",e[5])),e[3].insert(new p("Estatua de Atenea","Fue hecha por Fidias, siete años después de su muerte. Le falta la lanza.",q(7),q(8),"¡Sal de mi presencia, estúpido mortal!")),e[3].insert(new p("Estatua de Hermes","Desde el techo caen gotas continuamente sobre su cabeza.",q(9),q(10),"La humedad me destruye.")),e[4].insert(new c("Hueso de gato","Este es un hueso de gato (o de la imagen de un gato).",1)),e[4].insert(new h("Escalera","Usted trata de ver hasta dónde llega, pero no puede. Está detrás de una puerta de cristal.","treinta y nueve","Usted se sorprende: La escalera tiene ahora muchos escalones más.",e[2])),e[4].insert(new y("Espejo opaco","En realidad, usted no tiene idea de por qué es un espejo. Hay algo muy extraño en él.",q(11),new h("Puerta oculta","Parece formada por diminutos fragmentos de cristal.","","Su imagen regresa al atravesar la puerta.",e[13]))),e[5].insert(new c("Vaso de agua","Por un momento cree ver un bote en el vaso.",1)),e[5].insert(new c("Candelabro","La llama en su extremo está inmóvil, como si fuera de cera.",1)),e[5].insert(new h("Puerta verde","Esta puerta conduce al patio interior.","","Usted atraviesa la puerta sin dificultades.",e[3])),e[5].insert(new h("Libro","Es un libro normal.","","¡Usted ha atravesado el libro!",e[12])),e[5].insert(new g("Cíclope","Parece estar cuidando la puerta.","¡Arrrggghhhh! ¡Me has matado!"+q(12),q(13))),e[5].insert(new h("Puerta","Es una puerta para gigantes.",q(14),"Usted se encuentra del otro lado de la puerta.",e[6])),e[6].insert(new c("Antorcha","La llama parece bailar en su propia luz.",1)),e[6].insert(new h("Puerta","Es una puerta para gigantes.",q(14),"Usted se encuentra del otro lado de la puerta.",e[5])),e[6].insert(new h("Puerta vieja","Es la puerta de las habitaciones de una bruja.","","Usted ha entrado.",e[7])),e[6].insert(new h("Puerta roja","Es la puerta del guerrero.","","Usted se encuentra del otro lado de la puerta.",e[8])),e[6].insert(new h("Puerta prohibida","Esta puerta está prohibida para los humanos.",q(15),"Usted se encuentra del otro lado de la puerta.",e[9])),e[6].insert(new h("Puerta gris","Esta puerta conduce a la sala de las infusiones.","","Usted se encuentra del otro lado de la puerta.",e[14])),e[7].insert(new c("Polvo mágico","Puede hacer invisible a cualquiera.",1)),e[7].insert(new c("Poción para crecer","Tiene un olor muy repugnante.",5)),e[7].insert(new h("Puerta vieja","Da al pasillo.","","Usted ha salido.",e[6])),e[7].insert(new f("Escaparate","Tiene las puertas llenas de arañazos.","",q(16),"Candelabro",e[13])),e[7].insert(new p("Bruja","Parece tener mil años.","Escoba",q(17),"Tráeme mi escoba y te daré un consejo.")),e[8].insert(new c("Vendajes","Están manchados de sangre.",3)),e[8].insert(new c("Grabado","En el grabado está usted, hablando con una muchacha.",3)),e[8].insert(new h("Puerta roja","Da al pasillo.","","Usted está en el pasillo nuevamente.",e[6])),e[8].insert(new y("Cama","Es tan fuerte que solo con un hacha podría romperla.",q(18),new h("Puerta","Está en el suelo.","","Usted entra a la armería.",e[10]))),e[9].insert(new c("Piedra filosofal","Usted es el primer humano en ver la quinta esencia.",10)),e[9].insert(new c("Máquina del tiempo","Es muy parecida a una máquina de moler carne.",3)),e[9].insert(new h("Puerta prohibida","Esta puerta está prohibida para los humanos.",q(15),"Usted se encuentra en el otro lado de la puerta.",e[6])),e[9].insert(new p("Homúnculo","Parece que escapó de algún frasco. Es tan pequeño que usted se arrodilla para verlo.","Poción para crecer",q(20),"¡Quiero crecer!")),e[10].insert(new c("Espada","Es muy brillante.",5)),e[10].insert(new c("Lanza","Está hecha de piedra.",10)),e[10].insert(new c("Arco","Es el arco de Odiseo.",5)),e[10].insert(new c("Daga","Es afilada como la lengua de la serpiente bíblica.",3)),e[10].insert(new c("Ariete","Demasiado grande y pesado.",30)),e[10].insert(new c("Látigo","Parece una culebra.",2)),e[10].insert(new h("Puerta","Está en el techo.","","Usted regresa al cuarto del guerrero.",e[8])),e[11].insert(new c("Rosa","Es más hermosa que todas las doncellas que usted no ha visto.",1)),e[11].insert(new c("Espejo","Usted se ve a sí mismo entregándole unos polvos al Troll.",20)),e[11].insert(new h("Puerta verde","Conduce al jardín.","","Usted entra al jardín.",e[12])),e[11].insert(new p("Troll","Está mirándose en un espejo. Tiene una figura tan repulsiva que usted aparta la vista.","Polvo mágico",q(22),"No me mates, por favor. Haz que nadie pueda ver mi fealdad.")),e[12].insert(new c("Cedro","Le faltan algunas ramas. Al parecer, alguien las cortó para hacerse una cama.",999)),e[12].insert(new h("Puerta verde","Conduce a los baños de la Bestia.","","Usted sale del jardín.",e[11])),e[12].insert(new h("Puerta azul","Debe haber algo hermoso detrás de esta puerta.","","Usted sale del jardín.",e[13])),e[12].insert(new h("Puerta amarilla","Conduce a la sala de infusiones.","","Usted sale del jardín.",e[14])),e[12].insert(new h("Puerta de hierro","Conduce a los calabozos.","","Usted entra a los calabozos.",e[15])),e[12].insert(new h("Puerta de madera","Conduce al almacén.","","Usted sale del jardín.",e[22])),e[13].insert(new c("Cuadro","Está completamente pintado de negro.",10)),e[13].insert(new c("Corazón de unicornio","Aún late.",1)),e[13].insert(new h("Puerta azul","Debe haber algo hermoso detrás de esta puerta.","","Usted sale al jardín.",e[12])),e[13].insert(new h("Puerta oculta","Parece formada por diminutos fragmentos de cristal.","","Su imagen regresa al atravesar la puerta.",e[4])),e[13].insert(new h("Escaparate","Las puertas son doradas.","","Usted sube durante varios minutos hasta llegar al escaparate de la bruja.",e[7])),e[13].insert(new p("Doncella","Nunca antes había contemplado tanta hermosura. Usted está como hipnotizado.",q(24),q(25),"¡Qué brusco! Un caballero debe dirigirse a una dama de otra forma.")),e[14].insert(new c("Taza de café","Humea.",1)),e[14].insert(new c("Cigarro","Está encendido.",1)),e[14].insert(new h("Puerta gris","Da al pasillo.","","Usted se encuentra del otro lado de la puerta.",e[6])),e[14].insert(new h("Puerta amarilla","Conduce al jardín.","","Usted sale al jardín.",e[12])),e[14].insert(new g("Arpía","Está desayunando. Usted recuerda a su suegra sin darse cuenta.",q(26),q(27))),e[15].insert(new c("Paraguas","Está cerrado.",2)),e[15].insert(new c("Talismán de aire","Está hecho de cinco vientos amarrados con un cordón negro.",1)),e[15].insert(new h("Puerta de hierro","Conduce al jardín.","","Usted sale al jardín.",e[12])),e[15].insert(new p("Esqueleto","Debe tener varios siglos.","Taza de café",q(29),"Dame algo para calentarme la barriga, por favor.")),e[16].insert(new h("Puerta triangular","Tiene forma de un triángulo de siete lados.","","Usted sale de la boca de la Bestia.",e[24])),e[16].insert(new b("Garganta","Es roja y carnosa.","Usted atraviesa por la garganta de la Bestia.",e[17])),e[17].insert(new c("Inscripción","No continúe si no está protegido.",10)),e[17].insert(new h("Garganta","Es roja y carnosa.","","Usted atraviesa por la garganta de la Bestia.",e[16])),e[17].insert(new f("Traquea","Luce igual que en los libros de biología que había en su escuela.","","Usted atraviesa por la tráquea de la Bestia.",q(30),e[18])),e[17].insert(new f("Esofago","Parece un túnel.","","Usted atraviesa por el esófago de la Bestia.",q(31),e[19])),e[17].insert(new f("Arteria principal","Conduce al corazón seguramente.","","Usted atraviesa por la arteria principal de la Bestia.","Corazón de unicornio",e[20])),e[18].insert(new h("Tráquea","Luce igual que en los libros de biología que había en su escuela.","","Usted atraviesa por la tráquea de la Bestia.",e[17])),e[18].insert(new g("Centro de los pulmones","De aquí surge la vida de los pulmones.",q(35),q(32))),e[19].insert(new h("Esófago","Parece un túnel.","","Usted atraviesa por el esófago de la Bestia.",e[17])),e[19].insert(new g("Centro del estomago","De aquí surge la vida del estómago.","¡Usted ha matado al centro del estómago!",q(33))),e[20].insert(new h("Arteria principal","Conduce al corazón seguramente.","","Usted atraviesa por la arteria principal de la Bestia.",e[17])),e[20].insert(new g("Centro del corazon","De aquí surge la vida del corazón.",q(37),q(34))),e[21].insert(new c("Inscripción",q(39),10)),e[21].insert(new g("Centro del cerebro","¡Usa la antorcha!","XVBCZXV XBVCZX BVZXC!!!!! ",q(38))),e[22].insert(new c("Hacha","Está muy afilada.",10)),e[22].insert(new h("Puerta de madera","Conduce al jardín.","","Usted sale del almacén.",e[12])),e[22].insert(new h("Puerta verde","Usted presiente que hay algo muy grande detrás de ella.","","Usted entra al páramo.",e[23])),e[22].insert(new p("Ratón","Tiene puesto un delantal de alquimista.",q(40),q(41),"No tengo tiempo para atenderte. Llevo medio siglo buscando la quinta esencia.")),e[23].insert(new h("Puerta verde","Conduce al almacén.","","Usted sale del páramo.",e[22])),e[23].insert(new h("Puerta de cristal","Es muy delgada.",q(42),"Usted sale del páramo.",e[24])),e[23].insert(new b("Pozo","Es muy profundo.","Usted cae vertiginosamente por el pozo y, antes de que pueda darse cuenta, está en el exterior de la fortaleza.",e[0])),e[23].insert(new g("Lobo","Es del tamaño de un ternero. La única forma de pasar por la puerta de cristal es matándolo.",q(44),"Latigo")),e[24].insert(new h("Puerta de cristal","Es muy delgada.",q(42),"Usted sale al páramo.",e[23])),e[24].insert(new h("Puerta de tela","Es una puerta normal, pero de tela.","","Usted está atrapado. No hay salida.",e[24])),e[24].insert(new w("Puerta triangular","Tiene forma de un triángulo de siete lados.","¿Cuál es el nombre del duende?",q(23),"Usted entra a la boca de la Bestia.",e[16])),e[24].insert(new p("Bailarina","Es muy joven.","Máquina del tiempo",q(47),"Quiero ser joven para siempre."))}function z(e,a=""){if(""===e)return;const t=document.getElementById("output"),s=document.createElement("div");s.className="output-line"+(a?" "+a:"");const r=document.createElement("span");r.className="text-reveal",r.textContent=e;const n=document.createElement("div");n.className="text-mask";const o=document.createElement("div");o.className="text-scanline",o.style.left="0px";const i=document.createElement("div");i.className="text-scanline-dot",o.appendChild(i),r.appendChild(n),r.appendChild(o),s.appendChild(r),t.appendChild(s);const l=r.offsetWidth;if(e.length>100)r.removeChild(n),r.removeChild(o);else{const a=Math.max(80,Math.min(200,3*e.length)),t=performance.now();requestAnimationFrame(function e(s){const i=s-t,d=Math.min(i/a,1),u=d*l;o.style.left=u+"px",n.style.clipPath=`inset(0 0 0 ${u}px)`,d<1?requestAnimationFrame(e):(r.removeChild(n),r.removeChild(o))})}t.scrollTop=t.scrollHeight}function B(){}const I={suggestions:[],currentIndex:-1,originalInput:""},S=["ir","atravesar","entrar","cruzar","pasar","tomar","coger","recoger","agarrar","dejar","soltar","tirar","ver","examinar","mirar","abrir","romper","matar","atacar","destruir","dar","hablar","preguntar","preguntarle","pesar","inventario","ayuda","guardar","cargar","partidas","borrar","salir","quit"],A=["con","a"];function _(){const e=[];return U.player&&U.player.curr&&U.player.curr.items.forEach(a=>{e.push({name:a.name,location:"room"})}),U.player&&U.player.bag&&U.player.bag.items.forEach(a=>{e.push({name:a.name,location:"inventory"})}),e}function D(e){if(!e)return[];const a=e.toLowerCase().split(" "),t=a[a.length-1];if(1!==a.length||e.endsWith(" ")){const t=a[0];if((["abrir","romper","matar","atacar","destruir"].includes(t)||"dar"===t&&!e.toLowerCase().includes(" a "))&&!e.toLowerCase().includes(" con ")&&!e.toLowerCase().includes(" a ")){const s=a.slice(1).join(" ").trim();if(""!==s&&e.endsWith(" "))return["dar"===t?"a":"con"];if(""!==s){const e=a.slice(1,-1).join(" ").trim(),s=a[a.length-1].toLowerCase(),r="dar"===t?"a":"con";if(""!==e&&r.startsWith(s)&&""!==s&&r!==s)return[r]}}let s=_(),r=a.slice(1).join(" ").trim();const n=e.toLowerCase().lastIndexOf(" con "),o=e.toLowerCase().lastIndexOf(" a ");if(-1!==n){if(r=e.substring(n+5).trim(),"abrir"===t)return[]}else-1!==o?r=e.substring(o+3).trim():["dar","dejar","soltar","tirar","pesar"].includes(t)?s=s.filter(e=>"inventory"===e.location):["tomar","coger","recoger","agarrar"].includes(t)&&(s=s.filter(e=>"room"===e.location));return s.filter(e=>e.name.toLowerCase().startsWith(r.toLowerCase())||""===r).map(e=>e.name)}return S.filter(e=>e.startsWith(t)&&e!==t).map(e=>e)}function N(e){const a=e.value;I.suggestions=D(a),I.currentIndex=-1,I.originalInput=a;const t=e.parentElement.querySelector(".autocomplete-suggestion");t&&t.remove(),I.suggestions.length>0&&W(e,I.suggestions[0])}function W(e,a){const t=e.parentElement.querySelector(".autocomplete-suggestion");t&&t.remove();const s=e.value;let r="";const n=s.split(" ");if(1!==n.length||s.endsWith(" "))if("con"===a||"a"===a)if(s.endsWith(" "))r=" "+a;else{const e=n[n.length-1].toLowerCase();if(!a.startsWith(e)||""===e)return;r=a.substring(e.length)}else{const e=n.slice(1).join(" ").trim();if(""===e)r=s.endsWith(" ")?" "+a:a;else{if(!a.toLowerCase().startsWith(e.toLowerCase()))return;r=a.substring(e.length)}}else{const e=n[0];if(!a.toLowerCase().startsWith(e.toLowerCase()))return;r=a.substring(e.length)}if(!r)return;const o=document.createElement("span");o.className="autocomplete-suggestion";let i=s;s.endsWith(" ")&&(i=s.slice(0,-1)),o.textContent=r;const l=document.createElement("span");l.style.visibility="hidden",l.style.position="absolute",l.style.whiteSpace="pre",l.style.font=window.getComputedStyle(e).font,l.textContent=i,document.body.appendChild(l);const d=l.offsetWidth;document.body.removeChild(l),o.style.position="absolute",o.style.left=e.offsetLeft+22-e.scrollLeft+d+"px",o.style.top=e.offsetTop+10+"px",o.style.pointerEvents="none",o.style.color="rgba(57, 255, 20, 0.35)",o.style.whiteSpace="pre",e.parentElement.appendChild(o)}function T(e){0!==I.suggestions.length&&(I.currentIndex+=e,I.currentIndex<0?I.currentIndex=I.suggestions.length-1:I.currentIndex>=I.suggestions.length&&(I.currentIndex=0),W(document.getElementById("input"),I.suggestions[I.currentIndex]))}function H(){if(0===I.suggestions.length)return!1;const e=document.getElementById("input"),a=e.value,t=I.suggestions[-1===I.currentIndex?0:I.currentIndex],s=a.split(" ");if(1===s.length||2===s.length&&a.endsWith(" "))a.endsWith(" ")?e.value=a+t+" ":e.value=t+" ";else{const r=s.slice(1).join(" ").trim();""===r?e.value=s[0]+" "+t+" ":t.toLowerCase().startsWith(r.toLowerCase())?e.value=a+t.substring(r.length)+" ":(s[s.length-1]=t,e.value=s.join(" ")+" ")}const r=e.parentElement.querySelector(".autocomplete-suggestion");return r&&r.remove(),I.suggestions=[],I.currentIndex=-1,N(e),!0}function F(){const e=["Centro del cerebro","Centro del corazon","Centro del estomago","Centro de los pulmones"];let a=!0;for(let t of e){let e=!1;for(let a of U.rooms)if(a.get(t)){e=!0;break}if(e){a=!1;break}}let t=!0;const s=U.rooms[11].get("Troll");s&&!s.dead&&(t=!1),a&&t&&(U.gameWon=!0,z("",""),z("¡¡¡VICTORIA!!!","success"),z("Usted ha vencido a la Bestia.","success"),z("Parece ser una persona persistente y eso es un mérito muy grande."),z("La persistencia es indispensable para los que luchan por el bien,"),z("sobre todo porque los que luchan por el mal son muy persistentes también."),z("Veremos si en la próxima versión de La Fortaleza tiene igual suerte."),z("",""),z("                                             Un servidor:","system"),z("                                             M. Cepero","system"))}window.processCommand=function(){if(U.gameOver||U.gameWon||U.player.dead)return;const e=document.getElementById("input"),a=e.value.trim();if(e.value="",!a)return;z("> "+a,"prompt");const t=a.toLowerCase().split(" "),s=t[0],r=t.slice(1).join(" ");switch(s){case"ayuda":case"help":z("Comandos disponibles:"),z("- ir/atravesar [lugar]: ir a un lugar"),z("- tomar/coger [objeto]: tomar un objeto"),z("- dejar/soltar [objeto]: dejar un objeto"),z("- dejar todo: dejar todos los objetos"),z("- mirar: mirar alrededor"),z("- ver/examinar [objeto]: examinar un objeto"),z("- inventario/i: ver tu inventario"),z("- abrir [puerta] con [palabra]: abrir una puerta"),z("- romper [objeto] con [arma]: romper algo"),z("- matar/atacar [objetivo] con [arma]: atacar algo"),z("- dar [objeto] a [quien]: dar un objeto"),z("- hablar/preguntar [quien]: hablar con alguien"),z("- pesar [objeto]: pesar un objeto"),z("- guardar [nombre]: guardar partida"),z("- cargar [nombre]: cargar partida"),z("- partidas: listar partidas guardadas"),z("- borrar [nombre]: borrar partida guardada"),z("- salir/quit: abandonar el juego");break;case"inventario":case"i":case"inv":U.player.inventary();break;case"mirar":case"look":U.player.look(!0);break;case"ver":case"examinar":case"v":U.player.see(r);break;case"tomar":case"coger":case"recoger":case"agarrar":U.player.take(r);break;case"dejar":case"soltar":case"tirar":"todo"===r?U.player.leaveAll():U.player.leave(r);break;case"ir":case"atravesar":case"entrar":case"cruzar":case"pasar":U.player.walkT(r);break;case"abrir":const e=a.split(" con "),t=e[0].replace("abrir ","").trim(),s=e[1]?e[1].trim():"";U.player.openD(t,s);break;case"romper":const n=a.split(" con "),o=n[0].replace("romper ","").trim(),c=n[1]?n[1].trim():"";U.player.breakItem(o,c);break;case"matar":case"atacar":case"destruir":const m=a.split(" con "),p=m[0].replace(/^(matar|atacar|destruir) /,"").trim(),g=m[1]?m[1].trim():"";U.player.kill(p,g);break;case"dar":const h=a.split(" a "),b=h[0].replace("dar ","").trim(),f=h[1]?h[1].trim():"";U.player.give(b,f);break;case"hablar":case"preguntar":case"preguntarle":U.player.ask(r);break;case"pesar":U.player.weigh(r);break;case"guardar":case"save":r?i(r):(u(),z(""),z("Escribe: guardar [nombre] para guardar tu juego","system"));break;case"cargar":case"load":r?l(r):(u(),z(""),z("Escribe: cargar [nombre] para cargar tu juego","system"));break;case"partidas":case"saves":case"listar":case"juegos":u();break;case"borrar":case"eliminar":case"delete":r?d(r):(u(),z(""),z("Escribe: borrar [nombre] para eliminar un juego","system"));break;case"salir":case"quit":case"morir":z("Su entierro se efectuará el próximo domingo a las 3:00 am. Está invitado.","system"),U.player.die(""),U.gameOver=!0;break;default:z('No entiendo ese comando. Escribe "ayuda" para ver comandos disponibles.',"error")}F()};const R=document.getElementById("input");R.addEventListener("input",function(e){N(this)}),R.addEventListener("keydown",function(e){if("Tab"===e.key)e.preventDefault(),H();else if("ArrowDown"===e.key)e.preventDefault(),T(1);else if("ArrowUp"===e.key)e.preventDefault(),T(-1);else if("Escape"===e.key){const e=this.parentElement.querySelector(".autocomplete-suggestion");e&&e.remove(),I.suggestions=[],I.currentIndex=-1}}),R.addEventListener("keypress",function(e){if("Enter"===e.key){const e=this.parentElement.querySelector(".autocomplete-suggestion");e&&e.remove(),I.suggestions=[],processCommand()}}),window.toggleFullscreen=function(){const e=document.documentElement,a=document.getElementById("fullscreen-btn");document.fullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),a.textContent="⛶"):(e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),a.textContent="⛶")},document.addEventListener("fullscreenchange",function(){document.getElementById("fullscreen-btn").textContent=(document.fullscreenElement,"⛶")}),L(),document.getElementById("input").focus();</script></body></html>